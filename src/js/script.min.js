function Landscape(){var e,t=this.points=[],n=this.lines=[],s=this.stars=[],o=[],h=[],i=0,c=[];t.push(new Vector2(.5,355.55)),t.push(new Vector2(5.45,355.55)),t.push(new Vector2(6.45,359.4)),t.push(new Vector2(11.15,359.4)),t.push(new Vector2(12.1,363.65)),t.push(new Vector2(14.6,363.65)),t.push(new Vector2(15.95,375.75)),t.push(new Vector2(19.25,388)),t.push(new Vector2(19.25,391.9)),t.push(new Vector2(21.65,400)),t.push(new Vector2(28.85,404.25)),t.push(new Vector2(30.7,412.4)),t.push(new Vector2(33.05,416.7)),t.push(new Vector2(37.9,420.5)),t.push(new Vector2(42.7,420.5)),t.push(new Vector2(47.4,416.65)),t.push(new Vector2(51.75,409.5)),t.push(new Vector2(56.55,404.25)),t.push(new Vector2(61.3,400)),t.push(new Vector2(63.65,396.15)),t.push(new Vector2(68,391.9)),t.push(new Vector2(70.3,388)),t.push(new Vector2(75.1,386.1)),t.push(new Vector2(79.85,379.95)),t.push(new Vector2(84.7,378.95)),t.push(new Vector2(89.05,375.65)),t.push(new Vector2(93.75,375.65)),t.push(new Vector2(98.5,376.55)),t.push(new Vector2(103.2,379.95)),t.push(new Vector2(104.3,383.8)),t.push(new Vector2(107.55,388)),t.push(new Vector2(108.95,391.9)),t.push(new Vector2(112.4,396.15)),t.push(new Vector2(113.3,400)),t.push(new Vector2(117.1,404.25)),t.push(new Vector2(121.95,404.25)),t.push(new Vector2(125.3,396.3)),t.push(new Vector2(128.6,394.2)),t.push(new Vector2(132.45,396.15)),t.push(new Vector2(135.75,399.9)),t.push(new Vector2(138.15,408.15)),t.push(new Vector2(144.7,412.4)),t.push(new Vector2(146.3,424.8)),t.push(new Vector2(149.55,436.65)),t.push(new Vector2(149.55,441.05)),t.push(new Vector2(154.35,444.85)),t.push(new Vector2(163.45,444.85)),t.push(new Vector2(168.15,441.05)),t.push(new Vector2(172.95,436.75)),t.push(new Vector2(175.45,432.9)),t.push(new Vector2(179.7,428.6)),t.push(new Vector2(181.95,424.8)),t.push(new Vector2(186.7,422.5)),t.push(new Vector2(189.15,412.4)),t.push(new Vector2(191.55,404.35)),t.push(new Vector2(196.35,402.4)),t.push(new Vector2(200.7,398.1)),t.push(new Vector2(205.45,391.9)),t.push(new Vector2(210.15,383.8)),t.push(new Vector2(212.55,375.75)),t.push(new Vector2(216.85,371.8)),t.push(new Vector2(219.3,367.55)),t.push(new Vector2(220.65,363.65)),t.push(new Vector2(224,359.4)),t.push(new Vector2(228.8,359.4)),t.push(new Vector2(233.55,355.55)),t.push(new Vector2(237.85,348.45)),t.push(new Vector2(242.65,343.2)),t.push(new Vector2(245,335.15)),t.push(new Vector2(247.35,322.8)),t.push(new Vector2(247.3,314.5)),t.push(new Vector2(248.35,306.55)),t.push(new Vector2(252.2,296.5)),t.push(new Vector2(256.55,294.55)),t.push(new Vector2(257.95,290.4)),t.push(new Vector2(261.25,285.95)),t.push(new Vector2(265.95,285.95)),t.push(new Vector2(267,290.25)),t.push(new Vector2(271.75,290.25)),t.push(new Vector2(273.25,294.55)),t.push(new Vector2(275.2,294.55)),t.push(new Vector2(278.95,296.5)),t.push(new Vector2(282.25,300.3)),t.push(new Vector2(284.7,308.45)),t.push(new Vector2(291.85,312.65)),t.push(new Vector2(298.55,330.8)),t.push(new Vector2(303.25,331.8)),t.push(new Vector2(308,335.05)),t.push(new Vector2(309,338.9)),t.push(new Vector2(312.35,343.2)),t.push(new Vector2(313.8,347.05)),t.push(new Vector2(317.05,351.4)),t.push(new Vector2(321.9,351.4)),t.push(new Vector2(322.85,363.8)),t.push(new Vector2(326.6,375.75)),t.push(new Vector2(326.6,379.95)),t.push(new Vector2(330.9,379.95)),t.push(new Vector2(332.4,383.8)),t.push(new Vector2(335.8,388)),t.push(new Vector2(338.1,396.15)),t.push(new Vector2(340.45,400.1)),t.push(new Vector2(345.3,404.25)),t.push(new Vector2(346.25,416.65)),t.push(new Vector2(349.6,428.7)),t.push(new Vector2(349.6,432.85)),t.push(new Vector2(350.95,436.75)),t.push(new Vector2(354.3,441.05)),t.push(new Vector2(359,441.05)),t.push(new Vector2(361.4,449.1)),t.push(new Vector2(363.95,453)),t.push(new Vector2(368.2,457.2)),t.push(new Vector2(372.9,461)),t.push(new Vector2(410.2,461)),t.push(new Vector2(412.55,449.1)),t.push(new Vector2(417.4,441.05)),t.push(new Vector2(419.7,432.9)),t.push(new Vector2(422.05,432.9)),t.push(new Vector2(425.45,424.8)),t.push(new Vector2(428.8,422.35)),t.push(new Vector2(433.45,416.65)),t.push(new Vector2(438.25,415.15)),t.push(new Vector2(442.6,412.4)),t.push(new Vector2(447.4,412.4)),t.push(new Vector2(448.8,416.65)),t.push(new Vector2(454.55,430.55)),t.push(new Vector2(455.5,434.8)),t.push(new Vector2(459.25,438.6)),t.push(new Vector2(462.6,440.9)),t.push(new Vector2(466,444.85)),t.push(new Vector2(468.35,452.9)),t.push(new Vector2(475.55,457.3)),t.push(new Vector2(484.7,457.3)),t.push(new Vector2(494.7,458.2)),t.push(new Vector2(503.75,461.1)),t.push(new Vector2(522.2,461.1)),t.push(new Vector2(524.75,453)),t.push(new Vector2(527.1,441.05)),t.push(new Vector2(527.1,432.9)),t.push(new Vector2(531.9,432.9)),t.push(new Vector2(534.15,424.8)),t.push(new Vector2(538.6,420.5)),t.push(new Vector2(540.9,416.65)),t.push(new Vector2(542.35,412.5)),t.push(new Vector2(545.7,408)),t.push(new Vector2(550.45,408)),t.push(new Vector2(552.85,398.1)),t.push(new Vector2(554.75,389.95)),t.push(new Vector2(559.55,388)),t.push(new Vector2(564.35,391.9)),t.push(new Vector2(573.35,391.9)),t.push(new Vector2(578.1,388)),t.push(new Vector2(579.55,379.95)),t.push(new Vector2(582.9,369.4)),t.push(new Vector2(587.75,367.55)),t.push(new Vector2(588.65,363.8)),t.push(new Vector2(592.05,359.5)),t.push(new Vector2(596.85,355.55)),o.push(new LandingZone(0,4)),o.push(new LandingZone(13,3)),o.push(new LandingZone(25,4)),o.push(new LandingZone(34,4)),o.push(new LandingZone(63,5)),o.push(new LandingZone(75,4)),o.push(new LandingZone(106,5)),o.push(new LandingZone(111,2)),o.push(new LandingZone(121,5)),o.push(new LandingZone(133,2)),o.push(new LandingZone(148,3)),h.push([2,3,7,9]),h.push([7,8,9,10]),h.push([2,3,7,9]),h.push([1,4,7,9]),h.push([0,5,7,9]),h.push([6,7,8,9]),h.push([1,4,7,9]),e=this.tileWidth=1.5*t[t.length-1].x;for(var r=0;r<t.length;r++){var p=t[r];p.x*=1.5,p.y*=1.5,p.y-=50}for(r=1;r<t.length;r++){var u=t[r-1],a=t[r];n.push(new LandscapeLine(u,a))}for(r=0;r<n.length;r++)if(Math.random()<.1){var w=n[r],V={x:w.p1.x,y:600*Math.random()};V.y<w.p1.y&&V.y<w.p2.y&&s.push(V)}this.render=function(t,o){for(var h=0;o.left-h>e;)h+=e;for(;o.left-h<0;)h-=e;for(var i=h,r=0;n[r].p2.x+h<o.left;)++r>n.length&&(r=0,h+=e);t.beginPath();var p=n[r],u=0;Math.random()<.3&&(h+=.2/o.scale,u=.2/o.scale),t.moveTo(p.p1.x+h,p.p1.y+u);for(var a=0;(p=n[r]).p1.x+h<o.right;){var w,l=p.p2;if(t.lineTo(l.x+h,l.y),counter%20>10&&1!=p.multiplier)c[a]?(w=c[a]).show():(w=c[a]=new InfoBox(1,50),document.body.appendChild(w.domElement)),w.setText(p.multiplier+"x"),w.setX(((p.p2.x-p.p1.x)/2+p.p1.x+h)*o.scale+o.x),w.setY((p.p2.y+2)*o.scale+o.y),a++;++r>=n.length&&(r=0,h+=e)}var d=.5*Math.sin(.8*counter)+.5;if(d>.5){t.lineWidth=2/o.scale;var x=Math.round(100*(d-.5));t.strokeStyle="rgb("+x+","+x+","+x+")",t.stroke()}t.strokeStyle="white",t.lineWidth=1/o.scale*(.2*d+.8),t.lineJoin="bevel",t.stroke();for(r=a;r<c.length;r++)c[r].hide();for(r=0,h=i;s[r].x+h<o.left;)++r>=s.length&&(r=0,h+=e);for(t.beginPath();(V=s[r]).x+h<o.right;){for(var y=V.x+h,f=V.y;o.bottom<f;)f-=600;t.rect(y,f,1/o.scale,1/o.scale),f-600>o.top&&(f-=600,t.rect(y,f,1/o.scale,1/o.scale)),++r>=s.length&&(r=0,h+=e)}t.stroke()};this.setZones=function(){for(var e=0;e<n.length;e++)n[e].multiplier=1;var t=h[i];for(e=0;e<t.length;e++){var s=t[e],c=o[s];(w=n[c.lineNum]).multiplier=c.multiplier}++i>=h.length&&(i=0)}}function LandscapeLine(e,t){this.p1=e,this.p2=t,this.landable=e.y==t.y,this.multiplier=1}function LandingZone(e,t){this.lineNum=e,this.multiplier=t}function Sound(e){this.sound=document.createElement("audio"),this.sound.src=e,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.style.display="none",document.body.appendChild(this.sound),this.play=function(){this.sound.play()},this.stop=function(){this.sound.pause()},this.loop=function(){this.sound.setAttribute("loop","loop")},this.reset=function(){this.sound.currentTime=0}}var canvas=document.getElementById("game"),context=canvas.getContext("2d"),stars=[],gravity=.025,starColor=["#111","#111","#111","#111","#111","#111","#111","#25aafc","#ce2c00"],fuel=5e3,spaceship={color:"#ffffff",width:8,height:42,thrust:.045,maxThrust:maxThrust=2,terminalV:terminalV=-2,position:{x:100,y:10},angle:0,velocity:{x:0,y:0},engineOn:!1,rotatingLeft:!1,rotatingRight:!1};function updateScore(){context.font="30px hyperspaceregular",context.fillStyle="#40cc00",context.fillText("JS Lunar Lander",10,40),context.font="12px hyperspaceregular",context.fillStyle="#fff",context.fillText("Alt: "+Math.floor(canvas.height-spaceship.position.y),canvas.width-120,20),context.fillText("Fuel: "+fuel,canvas.width-120,35),context.fillText("Speed H: "+Math.round(100*spaceship.velocity.x)/100,canvas.width-120,50),context.fillText("Speed V: "+Math.round(100*spaceship.velocity.y)/100,canvas.width-120,65)}function updateSpaceship(){spaceship.position.x+=spaceship.velocity.x,spaceship.position.y+=spaceship.velocity.y,spaceship.position.y>=canvas.height+spaceship.height&&(spaceship.position.y=0),spaceship.position.x<0&&(spaceship.position.x=canvas.width),spaceship.position.x>canvas.width&&(spaceship.position.x=0),spaceship.rotatingRight?spaceship.angle+=Math.PI/180:spaceship.rotatingLeft&&(spaceship.angle-=Math.PI/180),spaceship.engineOn&&fuel>0&&(spaceship.velocity.x-=spaceship.thrust*Math.sin(-spaceship.angle),spaceship.velocity.y-=spaceship.thrust*Math.cos(spaceship.angle),fuel--),spaceship.velocity.y+=gravity,spaceship.velocity.y>=maxThrust&&(spaceship.velocity.y=maxThrust),spaceship.velocity.y<=terminalV&&(spaceship.velocity.y=terminalV),console.log(fuel)}function draw(){context.clearRect(0,0,canvas.width,canvas.height),updateSpaceship(),drawStars(),drawSpaceship(),updateScore(),spaceship.position.y<0&&drawSpaceshipHash(),requestAnimationFrame(draw)}function getRandomFloat(e,t){return Math.random()*(t-e)+e}function KeyUp(e){switch(e.keyCode){case 37:spaceship.rotatingLeft=!1;break;case 39:spaceship.rotatingRight=!1;break;case 38:spaceship.engineOn=!1}}function KeyDown(e){switch(e.keyCode){case 37:spaceship.rotatingLeft=!0;break;case 39:spaceship.rotatingRight=!0;break;case 38:spaceship.engineOn=!0}}function drawSpaceship(){context.save(),context.beginPath(),context.translate(spaceship.position.x,spaceship.position.y),context.rotate(spaceship.angle),context.rect(-.5*spaceship.width,-.5*spaceship.height,spaceship.width,spaceship.height),context.fillStyle=spaceship.color,context.fill(),context.closePath(),spaceship.engineOn&&fuel>0&&(context.beginPath(),context.moveTo(-.5*spaceship.width,.5*spaceship.height),context.lineTo(.5*spaceship.width,.5*spaceship.height),context.lineTo(0,.5*spaceship.height+10*Math.random()),context.lineTo(-.5*spaceship.width,.5*spaceship.height),context.closePath(),context.fillStyle="orange",context.fill()),context.restore()}function drawSpaceshipHash(){context.save(),context.beginPath(),context.moveTo(spaceship.position.x,0),context.lineTo(spaceship.position.x,10),context.strokeStyle="#ff0000",context.stroke()}draw(),$(window).resize(function(){xLimit=resetWindowLimit("x"),yLimit=resetWindowLimit("y")}),document.addEventListener("keyup",KeyUp),document.addEventListener("keydown",KeyDown);for(var i=0;i<500;i++)stars[i]={x:Math.random()*canvas.width,y:Math.random()*canvas.height,radius:Math.sqrt(2*Math.random())/2,alpha:1,decreasing:!0,dRatio:.05*Math.random()};function drawStars(){context.save(),context.fillStyle="#111",context.fillRect(0,0,canvas.width,canvas.height);for(var e=0;e<stars.length;e++){var t=stars[e];context.beginPath(),context.arc(t.x,t.y,t.radius,0,2*Math.PI),context.closePath(),context.fillStyle="rgba(255, 255, 255, "+t.alpha+")",1==t.decreasing?(t.alpha-=t.dRatio,t.alpha<.1&&(t.decreasing=!1)):(t.alpha+=t.dRatio,t.alpha>.95&&(t.decreasing=!0)),context.fill()}context.restore()}var Vector2=function(e,t){this.x=e||0,this.y=t||0};Vector2.prototype={reset:function(e,t){return this.x=e,this.y=t,this},toString:function(e){e=e||3;var t=Math.pow(10,e);return"["+Math.round(this.x*t)/t+", "+Math.round(this.y*t)/t+"]"},clone:function(){return new Vector2(this.x,this.y)},copyTo:function(e){e.x=this.x,e.y=this.y},copyFrom:function(e){this.x=e.x,this.y=e.y},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},magnitudeSquared:function(){return this.x*this.x+this.y*this.y},normalise:function(){var e=this.magnitude();return this.x=this.x/e,this.y=this.y/e,this},reverse:function(){return this.x=-this.x,this.y=-this.y,this},plusEq:function(e){return this.x+=e.x,this.y+=e.y,this},plusNew:function(e){return new Vector2(this.x+e.x,this.y+e.y)},minusEq:function(e){return this.x-=e.x,this.y-=e.y,this},minusNew:function(e){return new Vector2(this.x-e.x,this.y-e.y)},multiplyEq:function(e){return this.x*=e,this.y*=e,this},multiplyNew:function(e){return this.clone().multiplyEq(e)},divideEq:function(e){return this.x/=e,this.y/=e,this},divideNew:function(e){return this.clone().divideEq(e)},dot:function(e){return this.x*e.x+this.y*e.y},angle:function(e){return Math.atan2(this.y,this.x)*(e?1:Vector2Const.TO_DEGREES)},rotate:function(e,t){var n=Math.cos(e*(t?1:Vector2Const.TO_RADIANS)),s=Math.sin(e*(t?1:Vector2Const.TO_RADIANS));return Vector2Const.temp.copyFrom(this),this.x=Vector2Const.temp.x*n-Vector2Const.temp.y*s,this.y=Vector2Const.temp.x*s+Vector2Const.temp.y*n,this},equals:function(e){return this.x==e.x&&this.y==e.x},isCloseTo:function(e,t){return!!this.equals(e)||(Vector2Const.temp.copyFrom(this),Vector2Const.temp.minusEq(e),Vector2Const.temp.magnitudeSquared()<t*t)},rotateAroundPoint:function(e,t,n){Vector2Const.temp.copyFrom(this),Vector2Const.temp.minusEq(e),Vector2Const.temp.rotate(t,n),Vector2Const.temp.plusEq(e),this.copyFrom(Vector2Const.temp)},isMagLessThan:function(e){return this.magnitudeSquared()<e*e},isMagGreaterThan:function(e){return this.magnitudeSquared()>e*e}},Vector2Const={TO_DEGREES:180/Math.PI,TO_RADIANS:Math.PI/180,temp:new Vector2};